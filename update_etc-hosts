#!/bin/bash
set -e

# 追加するホストエントリ
HOST_ENTRY="163.220.178.192 harbor.ip-163-220-178-192.compute.mdx1.jp"

# kubectl を使ってノードの IP アドレスを取得
NODE_IPS=$(kubectl get nodes -o jsonpath='{.items[*].status.addresses[?(@.type=="InternalIP")].address}')

# 各ノードに SSH で接続して /etc/hosts に追加
for ip in $NODE_IPS; do
  echo "Updating /etc/hosts on node $ip..."
  ssh "$ip" "echo '$HOST_ENTRY' | sudo tee -a /etc/hosts"
done
